<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Tester</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container">
        <h1>Performance Tester</h1>

        <div class="form-group">
            <label for="url-select">Select a predefined site or choose 'Custom'</label>
            <select id="url-select">
                <option value="https://www.theguardian.com/">The Guardian https://www.theguardian.com/</option>
                <option value="https://plaxidityx.com/">PlaxidityX https://plaxidityx.com/</option>
                <option value="https://example.com/">Example.com https://example.com/</option>
                <option value="custom" selected>Custom URL</option>
            </select>
        </div>

        <div class="form-group" id="custom-url-group" style="display: block;">
            <label for="url-input">Enter Custom URL</label>
            <input type="text" id="url-input" placeholder="https://your-site.com">
        </div>

        <div class="options-group">
            <div class="form-group">
                <label for="mode-select">Test Mode</label>
                <select id="mode-select">
                    <option value="pagespeed-mobile">PageSpeed Mobile</option>
                    <option value="pagespeed-desktop">PageSpeed Desktop</option>
                    <option value="custom" selected>Custom (Default)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="runs-select">Number of Runs</label>
                <select id="runs-select">
                    <option value="1">1</option>
                    <option value="3" selected>3 (recommended)</option>
                    <option value="5">5</option>
                </select>
            </div>
            <label style="align-self: center; margin-top: 1rem;"><input type="checkbox" id="disable-cache-checkbox"> Disable Cache (First Load)</label>
        </div>

        <div class="rules-section">
            <h2>Advanced Rules (Optional)</h2>
            <div class="form-group">
                <label for="block-rules">Block Resources</label>
                <div class="rule-options" id="block-rule-options">
                    <fieldset>
                        <legend>Analytics</legend>
                        <label><input type="checkbox" value="googletagmanager.com"> googletagmanager.com</label>
                        <label><input type="checkbox" value="google-analytics.com"> google-analytics.com</label>
                    </fieldset>
                    <fieldset>
                        <legend>Ads</legend>
                        <label><input type="checkbox" value="doubleclick.net"> doubleclick.net</label>
                        <label><input type="checkbox" value="googlesyndication.com"> googlesyndication.com</label>
                    </fieldset>
                    <fieldset>
                        <legend>Common Types</legend>
                        <label><input type="checkbox" value=".png,.jpg,.jpeg,.gif,.svg,.webp"> All Images</label>
                        <label><input type="checkbox" value="fonts.googleapis.com,.woff2,.ttf"> Fonts</label>
                        <label><input type="checkbox" value=".css"> All CSS</label>
                    </fieldset>
                    <fieldset>
                        <legend>Libs & 3rd Parties</legend>
                        <label><input type="checkbox" value="jquery.js,jquery.min.js"> jQuery</label>
                        <label><input type="checkbox" value="jquery-migrate"> jQuery Migrate</label>
                        <label><input type="checkbox" value="cookiebot.com,uc.js"> Cookiebot</label>
                    </fieldset>
                </div>
                <input type="text" id="block-rules" placeholder="e.g., googletagmanager, .css">
                <small style="color: #6c757d;">Select presets or enter comma-separated URL fragments to block.</small>
            </div>
            <div class="form-group">
                <label for="defer-rules">Defer Scripts</label>
                <div class="rule-options" id="defer-rule-options">
                    <fieldset>
                        <legend>Analytics</legend>
                        <label><input type="checkbox" value="googletagmanager.com"> googletagmanager.com</label>
                        <label><input type="checkbox" value="google-analytics.com"> google-analytics.com</label>
                    </fieldset>
                    <fieldset>
                        <legend>Ads</legend>
                        <label><input type="checkbox" value="doubleclick.net"> doubleclick.net</label>
                        <label><input type="checkbox" value="googlesyndication.com"> googlesyndication.com</label>
                    </fieldset>
                    <fieldset>
                        <legend>Widgets</legend>
                        <label><input type="checkbox" value="intercom.io"> intercom.io</label>
                        <label><input type="checkbox" value="livechatinc.com"> livechatinc.com</label>
                        <label><input type="checkbox" value="connect.facebook.net"> connect.facebook.net</label>
                        <label><input type="checkbox" value="platform.twitter.com"> platform.twitter.com</label>
                    </fieldset>
                    <fieldset>
                        <legend>Libs & 3rd Parties</legend>
                        <label><input type="checkbox" value="jquery.js,jquery.min.js"> jQuery</label>
                        <label><input type="checkbox" value="jquery-migrate"> jQuery Migrate</label>
                        <label><input type="checkbox" value="cookiebot.com,uc.js"> Cookiebot</label>
                    </fieldset>
                </div>
                <input type="text" id="defer-rules" placeholder="e.g., analytics.js, chat-widget.js">
                <small style="color: #6c757d;">Select presets or enter comma-separated script URL fragments to defer.</small>
            </div>
            <div class="form-group">
                <label>Replace HTML Content</label>
                <div class="rule-group">
                    <input type="text" id="html-find-rule" placeholder="Find (supports regex)">
                    <input type="text" id="html-replace-rule" placeholder="Replace with">
                </div>
                <small style="color: #6c757d;">The 'Find' field is treated as a global regular expression. For example, to remove all `<img>` tags, use `&lt;img[^>]*&gt;` in 'Find' and leave 'Replace' empty.</small>
                <div class="preset-actions" id="html-replace-presets">
                    <fieldset>
                        <legend>WP Rocket Presets</legend>
                        <!-- Note: Quotes within data attributes are HTML-escaped as &quot; -->
                        <button type="button" data-find="media='print' onload=&quot;this.media='all'&quot;" data-replace="media='all'">Disable RUCSS</button>
                        <button type="button" data-find="type=&quot;text/rocketscript&quot;" data-replace="type=&quot;text/javascript&quot;">Disable JS Delay</button>
                        <button type="button" data-find="&lt;iframe([^&gt;]*)data-src=&quot;([^&quot;]+)&quot;" data-replace="&lt;iframe$1src=&quot;$2&quot;">Disable iFrame LazyLoad</button>
                        <button type="button" data-find="&lt;style id=&quot;wpr-usedcss&quot;&gt;[^&lt;]*&lt;/style&gt;" data-replace="">Remove Used CSS Block</button>
                    </fieldset>
                </div>
            </div>
        </div>

        <div class="naming-section">
             <div class="form-group">
                <label for="test-name-input">Name Your Test (Optional)</label>
                <input type="text" id="test-name-input" placeholder="e.g., Baseline, After Optimization, No Cookiebot">
                <small style="color: #6c757d;">Give this test a memorable name to easily identify it in the history.</small>
            </div>
        </div>

        <button id="run-test">Run Test</button>

        <div id="results">
            <div id="current-result">
                <h2>Current Result</h2>
                <p id="status">Awaiting test...</p>
                <div id="metrics-container" style="display: none;"></div>
                <img id="screenshot" style="display: none;" />
            </div>

            <div id="comparison-container" style="display: none;">
                 <h2>Comparison</h2>
                 <div id="comparison-view" class="comparison-view"></div>
            </div>

            <div id="history-container">
                <h2>Test History</h2>
                <p class="history-note">
                    <strong>Note:</strong> Your test history is saved in this browser's local storage. It will be lost if you clear your browser data. For permanent storage, please use the <strong>Export to CSV</strong> button.
                </p>
                <div id="history-controls">
                    <div>
                        <button id="compare-btn">Compare Selected</button>
                        <button id="clear-history-btn">Clear History</button>
                        <button id="export-csv-btn">Export to CSV</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="history-table">
                        <thead><tr><th></th><th>Name / URL</th><th>Mode</th><th>Cache</th><th>Rules</th><th>Avg FCP (ms)</th><th>Avg LCP (ms)</th></tr></thead>
                        <tbody id="history-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="main.js" defer></script>


</body>
</html>